flowchart TB
  %% Component view inside Ordering Service
  classDef comp fill:#f7f7f7,stroke:#333,stroke-width:1px;
  classDef ext fill:#fff,stroke:#666,stroke-dasharray: 4 3;

  subgraph OS["Ordering Service (Mtogo.Ordering.Api)"]
    direction TB
    API["HTTP API Layer\n(Endpoints)"]:::comp
    APP["Application Layer\n(OrderService)"]:::comp
    DOM["Domain Model\n(Pricing Rules)"]:::comp
    INT["Integration Client\n(LegacyMenuClient)"]:::comp
    PUB["MassTransit Publisher\n(IPublishEndpoint)"]:::comp
    SUB["PaymentFailedConsumer\n(Compensation Listener)"]:::comp
    ERR["Fallback Handling\n(Try/Catch Pattern)"]:::comp
  end

  RMQ["RabbitMQ Broker"]:::ext
  LEG["Legacy Menu API"]:::ext

  API --> APP
  APP --> DOM
  APP --> INT
  APP --> PUB
  APP --> ERR
  
  INT -->|HTTP| LEG
  PUB -->|Events| RMQ
  RMQ -->|Events| SUB
  SUB -->|Update Status| APP